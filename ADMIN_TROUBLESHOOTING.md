# حل مشاكل صفحة الإدارة

## المشكلة الحالية
صفحة الإدارة لا تعمل - خطأ 500 عند تحميل البيانات.

## الحلول

### الحل 1: التحقق من السياسات RLS

نفذ ملف `supabase/VERIFY_ADMIN_ACCESS.sql` للتحقق من:
1. وجود المستخدم الإداري
2. وجود السياسات الصحيحة
3. تفعيل RLS

### الحل 2: إعادة تطبيق السياسات

إذا كانت السياسات غير موجودة أو معطلة:

1. نفذ `supabase/FIX_RLS_POLICIES.sql` مرة أخرى
2. تأكد من أن المستخدم `tamer88` لديه `role = 'admin'` في جدول `profiles`

### الحل 3: التحقق من معرف المستخدم

تأكد من أن المستخدم الذي تسجلت به هو نفسه الذي لديه `role = 'admin'`:

```sql
-- التحقق من المستخدم الحالي
SELECT 
  auth.uid() as current_user_id,
  p.role,
  p.full_name
FROM profiles p
WHERE p.user_id = auth.uid();
```

### الحل 4: اختبار الوصول المباشر

جرب هذا الأمر في SQL Editor (بعد تسجيل الدخول كإداري):

```sql
-- هذا يجب أن يعمل إذا كانت السياسات صحيحة
SELECT COUNT(*) FROM visit_requests;
SELECT COUNT(*) FROM profiles;
```

إذا فشل، المشكلة في RLS policies.

## الميزات المتوفرة في صفحة الإدارة

بعد إصلاح المشكلة، ستجد:

1. **الإحصائيات**: عرض إجمالي الطلبات، قيد المراجعة، مقبولة، مرفوضة
2. **البحث والتصفية**: البحث بالاسم أو رقم الطلب، التصفية حسب الحالة أو النوع
3. **بطاقات الطلبات**: عرض جميع الطلبات مع تفاصيلها
4. **نافذة التفاصيل**: عند النقر على أي طلب:
   - معلومات المستخدم
   - معلومات الطلب الكاملة
   - صور الجوازات (جميع الأشخاص)
   - صور الدفعات
   - تحديث الحالة
   - إضافة ملاحظات
   - **الرد على المستخدم** (سيظهر في لوحة المستخدم)

## خطوات التحقق السريعة

1. ✅ تأكد من تسجيل الدخول كإداري
2. ✅ نفذ `VERIFY_ADMIN_ACCESS.sql` للتحقق
3. ✅ إذا فشل، نفذ `FIX_RLS_POLICIES.sql` مرة أخرى
4. ✅ حدّث الصفحة (F5)

## إذا استمرت المشكلة

1. افتح Console في المتصفح (F12)
2. انظر إلى رسائل الخطأ
3. شارك رسالة الخطأ الدقيقة


