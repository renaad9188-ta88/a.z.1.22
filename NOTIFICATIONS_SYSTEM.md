# نظام الإشعارات

## نظرة عامة
نظام إشعارات شامل يربط جميع الأحداث في المنصة ويضمن أن كل مستخدم يرى إشعاراته فقط.

## الميزات

### 1. Header ثابت في كل الصفحات
- Header يظهر في أعلى كل صفحة
- يعرض اسم المستخدم دائماً
- زر الإشعارات بجانب اسم المستخدم
- عداد للإشعارات غير المقروءة

### 2. إشعارات المستخدمين
كل مستخدم يستقبل إشعارات عند:
- ✅ موافقة على طلبه
- ✅ رفض طلبه
- ✅ رد من الإدارة
- ✅ موافقة على حجز الموعد
- ✅ رفض حجز الموعد
- ✅ تذكير قبل موعد القدوم

### 3. إشعارات الإدمن
كل إدمن يستقبل إشعارات عند:
- ✅ تقديم طلب جديد من أي مستخدم
- ✅ طلب حجز موعد جديد
- ✅ تحديث على طلب موجود

### 4. الفصل التام بين المستخدمين
- ✅ RLS Policies تضمن أن كل مستخدم يرى إشعاراته فقط
- ✅ NotificationsDropdown يستخدم filter حسب user_id
- ✅ لا يمكن لأي مستخدم رؤية إشعارات مستخدم آخر

## الخطوات المطلوبة

### 1. تنفيذ SQL Script
```sql
-- انظر ملف: supabase/CREATE_NOTIFICATIONS_TABLE.sql
```

هذا السكريبت ينشئ:
- جدول `notifications`
- RLS Policies للأمان
- دالة `create_notification` لإنشاء الإشعارات

### 2. استخدام النظام

#### للمستخدمين:
- الإشعارات تظهر تلقائياً في Header
- النقر على زر الإشعارات يعرض القائمة
- النقر على إشعار ينقلك للصفحة المرتبطة

#### للإدمن:
- الإشعارات تظهر في لوحة الإدارة
- إشعار عند أي حركة من المستخدمين
- يمكن مراجعة الطلبات مباشرة من الإشعارات

## الأحداث المرتبطة بالإشعارات

### للمستخدمين:
1. **موافقة على طلب** → إشعار نجاح
2. **رفض طلب** → إشعار خطأ
3. **رد من الإدارة** → إشعار معلومات
4. **موافقة على حجز** → إشعار نجاح
5. **رفض حجز** → إشعار تحذير

### للإدمن:
1. **طلب جديد** → إشعار معلومات
2. **طلب حجز موعد** → إشعار تحذير
3. **تحديث على طلب** → إشعار معلومات

## الملفات المضافة/المعدلة

### ملفات جديدة:
- `components/NotificationsDropdown.tsx`: مكون عرض الإشعارات
- `lib/notifications.ts`: دوال إنشاء الإشعارات
- `supabase/CREATE_NOTIFICATIONS_TABLE.sql`: SQL script لجدول الإشعارات

### ملفات معدلة:
- `components/Header.tsx`: إضافة زر الإشعارات
- `app/layout.tsx`: إضافة Header ثابت
- `components/AdminDashboard.tsx`: إضافة زر الإشعارات للإدمن
- `components/VisitRequestForm.tsx`: إشعار للإدمن عند تقديم طلب
- `components/admin/TripSchedulingModal.tsx`: إشعارات للإدمن والمستخدم
- `components/admin/RequestDetailsModal.tsx`: إشعارات عند الموافقة/الرفض/الرد

## ملاحظات مهمة

1. **الأمان**: RLS Policies تضمن الفصل التام بين المستخدمين
2. **التحديث التلقائي**: الإشعارات تتحدث كل 30 ثانية + في الوقت الفعلي
3. **التنقل**: النقر على إشعار ينقلك للصفحة المرتبطة تلقائياً
4. **العداد**: يظهر عدد الإشعارات غير المقروءة على زر الإشعارات



