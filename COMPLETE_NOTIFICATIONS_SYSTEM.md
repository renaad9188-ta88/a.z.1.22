# ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงูุดุงูู

## ูุธุฑุฉ ุนุงูุฉ
ูุธุงู ุฅุดุนุงุฑุงุช ุดุงูู ูุบุทู ุฌููุน ุงูุญุฑูุงุช ูู ุงููููุนุ ูุฑุณู ุฅุดุนุงุฑุงุช ูููุณุชุฎุฏููู ูุงูุฅุฏูู ุนูุฏ ูู ุญุฏุซ ููู.

## ุงูุฅุดุนุงุฑุงุช ุญุณุจ ุงูุญุฏุซ

### 1. ุนูุฏ ุชูุฏูู ุทูุจ ุฒูุงุฑุฉ ุฌุฏูุฏ
**ุงููุณุชุฎุฏู:**
- **ุงูุนููุงู:** "ุชู ุฅุฑุณุงู ุงูุทูุจ ุจูุฌุงุญ"
- **ุงูุฑุณุงูุฉ:** "ุชู ุฅุฑุณุงู ุทูุจ ุงูุฒูุงุฑุฉ ูู [ุงุณู ุงูุฒุงุฆุฑ] ุจูุฌุงุญ. ุณูุชู ูุฑุงุฌุนุชู ูู ูุจู ุงูุฅุฏุงุฑุฉ ูุฑูุจุงู."
- **ุงูููุน:** `success`
- **ุงููููุน:** `components/VisitRequestForm.tsx`

**ุงูุฅุฏูู:**
- **ุงูุนููุงู:** "ุทูุจ ุฌุฏูุฏ ุชู ุชูุฏููู"
- **ุงูุฑุณุงูุฉ:** "ุชู ุชูุฏูู ุทูุจ ุฌุฏูุฏ ูู [ุงุณู ุงููุณุชุฎุฏู] ูู [ุงุณู ุงูุฒุงุฆุฑ] ูู [ุงููุฏููุฉ]. ูุฑุฌู ูุฑุงุฌุนุชู."
- **ุงูููุน:** `info`
- **ุงููููุน:** `components/VisitRequestForm.tsx`

---

### 2. ุนูุฏ ุงูููุงููุฉ ุนูู ุงูุทูุจ
**ุงููุณุชุฎุฏู:**
- **ุงูุนููุงู:** "ุชู ูุจูู ุทูุจู"
- **ุงูุฑุณุงูุฉ:** "ุชู ูุจูู ุทูุจ ุงูุฒูุงุฑุฉ ูู [ุงุณู ุงูุฒุงุฆุฑ]. ููููู ุงูุขู ุญุฌุฒ ููุนุฏ ุงูุฑุญูุฉ."
- **ุงูููุน:** `success`
- **ุงููููุน:** `components/admin/RequestDetailsModal.tsx`

---

### 3. ุนูุฏ ุฑูุถ ุงูุทูุจ
**ุงููุณุชุฎุฏู:**
- **ุงูุนููุงู:** "ุชู ุฑูุถ ุทูุจู"
- **ุงูุฑุณุงูุฉ:** "ุชู ุฑูุถ ุทูุจ ุงูุฒูุงุฑุฉ ูู [ุงุณู ุงูุฒุงุฆุฑ]. [ุงูุณุจุจ ุฅู ูุฌุฏ]"
- **ุงูููุน:** `error`
- **ุงููููุน:** `components/admin/RequestDetailsModal.tsx`

---

### 4. ุนูุฏ ูุฌูุฏ ุฑุฏ ูู ุงูุฅุฏุงุฑุฉ
**ุงููุณุชุฎุฏู:**
- **ุงูุนููุงู:** "ุฑุฏ ูู ุงูุฅุฏุงุฑุฉ"
- **ุงูุฑุณุงูุฉ:** "ูุฏูู ุฑุฏ ุฌุฏูุฏ ูู ุงูุฅุฏุงุฑุฉ ุนูู ุทูุจู. ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุชูุงุตูู."
- **ุงูููุน:** `info`
- **ุงููููุน:** `components/admin/RequestDetailsModal.tsx`

---

### 5. ุนูุฏ ุทูุจ ุญุฌุฒ ููุนุฏ (ูู ุงููุณุชุฎุฏู)
**ุงููุณุชุฎุฏู:**
- **ุงูุนููุงู:** "ุชู ุฅุฑุณุงู ุทูุจ ุญุฌุฒ ุงูููุนุฏ"
- **ุงูุฑุณุงูุฉ:** "ุชู ุฅุฑุณุงู ุทูุจ ุญุฌุฒ ููุนุฏ ุงููุฏูู ูู [ุงูุชุงุฑูุฎ]. ุณูุชู ูุฑุงุฌุนุชู ูู ูุจู ุงูุฅุฏุงุฑุฉ ูุฑูุจุงู."
- **ุงูููุน:** `info`
- **ุงููููุน:** `components/admin/TripSchedulingModal.tsx`

**ุงูุฅุฏูู:**
- **ุงูุนููุงู:** "ุทูุจ ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ"
- **ุงูุฑุณุงูุฉ:** "ุทูุจ [ุงุณู ุงููุณุชุฎุฏู] ุญุฌุฒ ููุนุฏ ูุฏูู ูู [ุงุณู ุงูุฒุงุฆุฑ] ูู [ุงูุชุงุฑูุฎ]. ูุฑุฌู ูุฑุงุฌุนุชู ูุงูููุงููุฉ."
- **ุงูููุน:** `warning`
- **ุงููููุน:** `components/admin/TripSchedulingModal.tsx`

---

### 6. ุนูุฏ ุงูููุงููุฉ ุนูู ุญุฌุฒ ุงูููุนุฏ (ูู ุงูุฅุฏูู)
**ุงููุณุชุฎุฏู:**
- **ุงูุนููุงู:** "ุชู ุงูููุงููุฉ ุนูู ุญุฌุฒ ุงูููุนุฏ"
- **ุงูุฑุณุงูุฉ:** "ุชู ุงูููุงููุฉ ุนูู ุญุฌุฒ ููุนุฏ ุงููุฏูู ูู [ุงูุชุงุฑูุฎ]. ูุฑุฌู ุงูุงุณุชุนุฏุงุฏ ููุฑุญูุฉ."
- **ุงูููุน:** `success`
- **ุงููููุน:** `components/admin/TripSchedulingModal.tsx`

---

### 7. ุนูุฏ ุฑูุถ ุญุฌุฒ ุงูููุนุฏ
**ุงููุณุชุฎุฏู:**
- **ุงูุนููุงู:** "ุชู ุฑูุถ ุญุฌุฒ ุงูููุนุฏ"
- **ุงูุฑุณุงูุฉ:** "ุชู ุฑูุถ ุญุฌุฒ ุงูููุนุฏ ุงููุทููุจ. ูุฑุฌู ุงุฎุชูุงุฑ ููุนุฏ ุขุฎุฑ."
- **ุงูููุน:** `warning`
- **ุงููููุน:** `components/admin/TripSchedulingModal.tsx`

---

## ุงููููุงุช ุงูุฑุฆูุณูุฉ

### 1. `lib/notifications.ts`
ูุญุชูู ุนูู ุฌููุน ุฏูุงู ุฅูุดุงุก ุงูุฅุดุนุงุฑุงุช:
- `createNotification()` - ุฏุงูุฉ ุฃุณุงุณูุฉ ูุฅูุดุงุก ุฅุดุนุงุฑ
- `notifyRequestApproved()` - ุฅุดุนุงุฑ ููุงููุฉ ุนูู ุงูุทูุจ
- `notifyRequestRejected()` - ุฅุดุนุงุฑ ุฑูุถ ุงูุทูุจ
- `notifyAdminResponse()` - ุฅุดุนุงุฑ ุฑุฏ ูู ุงูุฅุฏุงุฑุฉ
- `notifyTripApproved()` - ุฅุดุนุงุฑ ููุงููุฉ ุนูู ุงูุญุฌุฒ
- `notifyTripRejected()` - ุฅุดุนุงุฑ ุฑูุถ ุงูุญุฌุฒ
- `notifyAdminNewRequest()` - ุฅุดุนุงุฑ ููุฅุฏูู: ุทูุจ ุฌุฏูุฏ
- `notifyAdminTripRequest()` - ุฅุดุนุงุฑ ููุฅุฏูู: ุทูุจ ุญุฌุฒ ููุนุฏ
- `notifyAllAdmins()` - ุฅุฑุณุงู ุฅุดุนุงุฑ ูุฌููุน ุงูุฅุฏูู
- `getAllAdmins()` - ุงูุญุตูู ุนูู ุฌููุน ุงูุฅุฏูู

### 2. `components/VisitRequestForm.tsx`
- ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุนูุฏ ุชูุฏูู ุงูุทูุจ
- ุฅุดุนุงุฑ ููุฅุฏูู ุนูุฏ ุชูุฏูู ุทูุจ ุฌุฏูุฏ

### 3. `components/admin/RequestDetailsModal.tsx`
- ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุนูุฏ ุงูููุงููุฉ/ุงูุฑูุถ
- ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุนูุฏ ูุฌูุฏ ุฑุฏ ูู ุงูุฅุฏุงุฑุฉ

### 4. `components/admin/TripSchedulingModal.tsx`
- ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุนูุฏ ุทูุจ ุงูุญุฌุฒ
- ุฅุดุนุงุฑ ููุฅุฏูู ุนูุฏ ุทูุจ ุงูุญุฌุฒ
- ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุนูุฏ ุงูููุงููุฉ/ุงูุฑูุถ ุนูู ุงูุญุฌุฒ

### 5. `components/NotificationsDropdown.tsx`
- ุนุฑุถ ุงูุฅุดุนุงุฑุงุช ูู ุงูููุช ุงููุนูู
- ุชุญุฏูุซ ุชููุงุฆู ูู 30 ุซุงููุฉ
- ุงุณุชูุงุน ููุชุบููุฑุงุช ูู ุงูููุช ุงููุนูู

---

## ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู `notifications`
```sql
CREATE TABLE notifications (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  title TEXT NOT NULL,
  message TEXT NOT NULL,
  type TEXT NOT NULL CHECK (type IN ('info', 'success', 'warning', 'error')),
  related_type TEXT, -- 'request', 'trip', 'payment', etc.
  related_id UUID, -- request_id, trip_id, etc.
  is_read BOOLEAN DEFAULT false,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  read_at TIMESTAMP WITH TIME ZONE
);
```

### ุฏุงูุฉ `create_notification`
ุฏุงูุฉ `SECURITY DEFINER` ุชุชุฌุงูุฒ RLS policies ูุฅูุดุงุก ุฅุดุนุงุฑุงุช ูุฃู ูุณุชุฎุฏู:
```sql
CREATE OR REPLACE FUNCTION create_notification(
  p_user_id UUID,
  p_title TEXT,
  p_message TEXT,
  p_type TEXT DEFAULT 'info',
  p_related_type TEXT DEFAULT NULL,
  p_related_id UUID DEFAULT NULL
)
RETURNS UUID
LANGUAGE plpgsql
SECURITY DEFINER
```

### ุฏุงูุฉ `get_all_admins`
ุฏุงูุฉ `SECURITY DEFINER` ููุญุตูู ุนูู ุฌููุน ุงูุฅุฏูู:
```sql
CREATE OR REPLACE FUNCTION get_all_admins()
RETURNS TABLE(user_id UUID)
LANGUAGE plpgsql
SECURITY DEFINER
```

---

## RLS Policies

### ูููุณุชุฎุฏููู:
- ูููููู ุฑุคูุฉ ุฅุดุนุงุฑุงุชูู ููุท
- ูููููู ุชุญุฏูุซ ุฅุดุนุงุฑุงุชูู (ูุฑุงุกุฉ/ุนุฏู ูุฑุงุกุฉ)

### ููุฅุฏูู:
- ูููููู ุฅูุดุงุก ุฅุดุนุงุฑุงุช ูุฃู ูุณุชุฎุฏู (ุนุจุฑ ุฏุงูุฉ `create_notification`)

---

## ุงูุชุญุฏูุซุงุช ูู ุงูููุช ุงููุนูู

`NotificationsDropdown` ูุณุชูุน ููุชุบููุฑุงุช ูู ุงูููุช ุงููุนูู:
```typescript
const channel = supabase
  .channel('notifications')
  .on(
    'postgres_changes',
    {
      event: '*',
      schema: 'public',
      table: 'notifications',
      filter: `user_id=eq.${userId}`,
    },
    () => {
      loadNotifications()
    }
  )
  .subscribe()
```

---

## ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู:
1. ุณุฌูู ุฏุฎูู ููุณุชุฎุฏู ุนุงุฏู
2. ูุฏูู ุทูุจ ุฒูุงุฑุฉ ุฌุฏูุฏ
3. ุชุญูู ูู ุฅุดุนุงุฑ "ุชู ุฅุฑุณุงู ุงูุทูุจ ุจูุฌุงุญ"
4. ุงูุชุธุฑ ููุงููุฉ ุงูุฅุฏูู
5. ุชุญูู ูู ุฅุดุนุงุฑ "ุชู ูุจูู ุทูุจู"

### 2. ุงุฎุชุจุงุฑ ุฅุดุนุงุฑุงุช ุงูุฅุฏูู:
1. ุณุฌูู ุฏุฎูู ูุฅุฏูู
2. ุงูุชุญ Console (F12)
3. ุฑุงูุจ ุงูุฅุดุนุงุฑุงุช ุนูุฏ:
   - ุชูุฏูู ุทูุจ ุฌุฏูุฏ ูู ูุณุชุฎุฏู
   - ุทูุจ ุญุฌุฒ ููุนุฏ ูู ูุณุชุฎุฏู

### 3. ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```sql
-- ุนุฑุถ ุขุฎุฑ 10 ุฅุดุนุงุฑุงุช
SELECT * FROM notifications 
ORDER BY created_at DESC 
LIMIT 10;

-- ุนุฑุถ ุฅุดุนุงุฑุงุช ูุณุชุฎุฏู ูุนูู
SELECT * FROM notifications 
WHERE user_id = '[user_id]'
ORDER BY created_at DESC;
```

---

## ููุงุญุธุงุช ูููุฉ

1. **ุฌููุน ุงูุฅุดุนุงุฑุงุช ุบูุฑ ูุชุฒุงููุฉ:** ูุง ุชููู ุงูุนูููุฉ ุฅุฐุง ูุดู ุงูุฅุดุนุงุฑ
2. **ุงูุชุณุฌูู ุงูุดุงูู:** ุฌููุน ุงูุฅุดุนุงุฑุงุช ูุณุฌูุฉ ูู Console ููุชุชุจุน
3. **ุงูุชุญุฏูุซ ุงูุชููุงุฆู:** ุงูุฅุดุนุงุฑุงุช ุชุธูุฑ ุชููุงุฆูุงู ูู `NotificationsDropdown`
4. **ุงูุฃูุงู:** ุงุณุชุฎุฏุงู `SECURITY DEFINER` ููุฏูุงู ุงูุญุณุงุณุฉ
5. **ุงูุฃุฏุงุก:** ุงูุฅุดุนุงุฑุงุช ุชูุฑุณู ุจุดูู ุบูุฑ ูุชุฒุงูู ุญุชู ูุง ุชุคุซุฑ ุนูู ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ

---

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. โ ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุนูุฏ ุชูุฏูู ุงูุทูุจ
2. โ ุฅุดุนุงุฑ ููุฅุฏูู ุนูุฏ ุชูุฏูู ุทูุจ ุฌุฏูุฏ
3. โ ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุนูุฏ ุงูููุงููุฉ/ุงูุฑูุถ
4. โ ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุนูุฏ ุทูุจ ุงูุญุฌุฒ
5. โ ุฅุดุนุงุฑ ููุฅุฏูู ุนูุฏ ุทูุจ ุงูุญุฌุฒ
6. โ ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุนูุฏ ุงูููุงููุฉ/ุงูุฑูุถ ุนูู ุงูุญุฌุฒ
7. โ ุชุญุฏูุซุงุช ูู ุงูููุช ุงููุนูู
8. โ ุนุฑุถ ุงูุฅุดุนุงุฑุงุช ูู Header

**ุงููุธุงู ุฌุงูุฒ ููุนูู ุจุดูู ุดุงูู! ๐**



