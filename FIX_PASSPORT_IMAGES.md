# إصلاح مشكلة عرض صور الجوازات في لوحة الإدارة

## المشكلة
صور الجوازات لا تظهر في لوحة الإدارة مع رسالة خطأ في الكونسول:
```
StorageApiError: Object not found
```

## السبب
1. الصور تُحفظ كـ public URLs لكن الـ bucket غير public
2. محاولة إنشاء signed URLs تفشل لأن الملفات غير موجودة أو المسارات غير صحيحة
3. سياسات RLS تمنع الإدمن من رؤية صور المستخدمين الآخرين

## الحلول المطبقة

### 1. تحسين دالة `getSignedImageUrl`
- إضافة معالجة أفضل للأخطاء
- استخدام الرابط الأصلي كـ fallback عند فشل إنشاء signed URL
- دعم أنواع مختلفة من الروابط

### 2. تحسين `RequestDetailsModal`
- استخدام الصور الأصلية عند فشل تحميل signed URLs
- إضافة معالجة أخطاء أفضل مع retry للروابط الأصلية
- إضافة lazy loading للصور

### 3. إضافة سياسة RLS للإدمن
تنفيذ السكريبت التالي في Supabase SQL Editor:
```sql
-- انظر ملف: supabase/ADD_ADMIN_STORAGE_POLICY.sql
```

## خطوات الإصلاح

### 1. تنفيذ SQL Script
1. افتح Supabase Dashboard
2. اذهب إلى SQL Editor
3. انسخ محتوى `supabase/ADD_ADMIN_STORAGE_POLICY.sql`
4. نفّذ السكريبت

### 2. التحقق من الصور
1. تأكد من أن الصور موجودة في Supabase Storage
2. تحقق من أن bucket `passports` موجود
3. تحقق من أن الصور محفوظة بالمسار الصحيح: `user_id/filename`

### 3. اختبار
1. سجّل الدخول كإدمن
2. افتح أي طلب
3. تحقق من ظهور صور الجوازات

## ملاحظات مهمة

- إذا استمرت المشكلة، تحقق من:
  - أن المستخدم مسجل كإدمن (`role = 'admin'` في جدول `profiles`)
  - أن الصور موجودة فعلاً في storage
  - أن المسارات في قاعدة البيانات صحيحة

- الصور الآن ستعمل حتى لو فشل إنشاء signed URLs (ستستخدم الروابط الأصلية)

